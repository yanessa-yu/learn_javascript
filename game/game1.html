<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>100以内加减运算练习</title>
  <style>
    :root{
      --bg:#f7f9fb;
      --card:#fff;
      --accent:#3b82f6;
      --ok:#16a34a;
      --err:#dc2626;
      --muted:#6b7280;
    }
    *{box-sizing:border-box}
    body{
      font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;
      margin:18px;
      background:var(--bg);
      color:#111827;
      -webkit-font-smoothing:antialiased;
    }

    .wrap{
      max-width:820px;
      margin:0 auto;
    }

    header{
      display:flex;
      align-items:center;
      gap:12px;
      margin-bottom:18px;
    }

    h1{font-size:20px;margin:0}

    .controls{
      display:flex;
      gap:8px;
      align-items:center;
      flex-wrap:wrap;
      margin-bottom:12px;
    }

    .card{
      background:var(--card);
      border-radius:10px;
      padding:14px;
      box-shadow:0 6px 18px rgba(16,24,40,0.06);
    }

    label{font-size:14px;color:var(--muted)}

    select,input[type="number"]{
      padding:6px 8px;
      border-radius:6px;
      border:1px solid #e6e9ef;
      font-size:14px;
      outline:none;
      background:white;
    }

    button{
      background:var(--accent);
      color:white;
      border:none;
      padding:8px 12px;
      border-radius:8px;
      font-weight:600;
      cursor:pointer;
    }

    button.secondary{
      background:#64748b;
    }

    .game{
      display:grid;
      grid-template-columns:1fr 280px;
      gap:14px;
      margin-top:12px;
    }

    .panel-large{
      padding:18px;
      display:flex;
      flex-direction:column;
      gap:10px;
      align-items:center;
      justify-content:center;
      min-height:220px;
    }

    .problem{
      font-size:48px;
      font-weight:700;
      margin-bottom:6px;
    }

    .row{
      display:flex;
      gap:8px;
      align-items:center;
    }

    input.answer{
      width:140px;
      font-size:28px;
      padding:8px 10px;
      border-radius:8px;
      border:1px solid #e6e9ef;
      text-align:center;
    }

    .feedback{
      height:26px;
      font-weight:600;
      font-size:15px;
    }

    .stats{
      display:flex;
      flex-direction:column;
      gap:8px;
    }

    .stat{
      display:flex;
      justify-content:space-between;
      padding:8px;
      border-radius:8px;
      background:#f1f5f9;
      font-size:14px;
    }

    .controls-col{
      display:flex;
      flex-direction:column;
      gap:8px;
    }

    .small{
      font-size:13px;
      color:var(--muted);
    }

    .progress{
      height:10px;
      background:#e6edf9;
      border-radius:999px;
      overflow:hidden;
    }

    .progress > i{
      display:block;
      height:100%;
      background:linear-gradient(90deg,var(--accent),#6ee7b7);
      width:0%;
    }

    .answer-correct{color:var(--ok)}
    .answer-wrong{color:var(--err)}

    .controls .hint{font-size:13px;color:var(--muted)}
    footer{margin-top:18px;font-size:13px;color:var(--muted)}
    @media (max-width:820px){
      .game{grid-template-columns:1fr}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>100以内加减运算练习</h1>
      <div class="small">随机生成不超过100的加法/减法题目，支持答题计时与判分</div>
    </header>

    <div class="card controls">
      <div class="row" style="gap:12px;">
        <label>题型:
          <select id="mode">
            <option value="add">加法</option>
            <option value="sub">减法</option>
            <option value="mix" selected>加减混合</option>
          </select>
        </label>

        <label>题数:
          <select id="count">
            <option>5</option>
            <option selected>10</option>
            <option>20</option>
            <option>50</option>
          </select>
        </label>

        <label>模式:
          <select id="modeType">
            <option value="practice" selected>练习（即时反馈）</option>
            <option value="test">测试（不显示答案）</option>
          </select>
        </label>

        <button id="startBtn">开始</button>
        <button id="nextBtn" class="secondary" disabled>下一题</button>
        <button id="showAnswerBtn" class="secondary" disabled>显示答案</button>
      </div>
      <div class="row" style="margin-top:8px;">
        <div class="hint">按 Enter 提交答案，或用“下一题”。减法结果保证非负；加法结果<=100。</div>
      </div>
    </div>

    <div class="game">
      <div class="card panel-large" aria-live="polite">
        <div style="width:100%;display:flex;justify-content:space-between;align-items:center">
          <div class="small">题目 <span id="indexDisplay">0/0</span></div>
          <div class="small">用时 <span id="timer">00:00</span></div>
        </div>

        <div style="text-align:center;width:100%">
          <div class="problem" id="problem">--</div>
          <div class="row" style="justify-content:center">
            <input type="number" id="answer" class="answer" placeholder="答案" min="0" max="100" disabled />
            <button id="submitBtn" disabled>提交</button>
          </div>
          <div class="feedback" id="feedback" aria-live="polite"></div>
        </div>
      </div>

      <aside class="card stats">
        <div class="stat"><span>正确</span><strong id="correct">0</strong></div>
        <div class="stat"><span>错误</span><strong id="wrong">0</strong></div>
        <div class="stat"><span>剩余题数</span><strong id="remaining">0</strong></div>

        <div>
          <div class="small" style="margin-bottom:6px">进度</div>
          <div class="progress" aria-hidden="true"><i id="prog"></i></div>
        </div>

        <div style="display:flex;gap:8px;flex-direction:column;margin-top:10px">
          <button id="resetBtn" class="secondary">重置</button>
          <button id="replayBtn">再来一轮</button>
        </div>

        <div style="margin-top:10px" class="small">说明：开始后会产生指定数量题目。练习模式会立即给出对错；测试模式会隐藏答案直到结束。</div>
      </aside>
    </div>

    <footer>实现说明：题目生成保证加法结果不超过100，减法结果不小于0。键盘 Enter 提交，Esc 清空答案。</footer>
  </div>

<script>
(function(){
  const modeEl = document.getElementById('mode');
  const countEl = document.getElementById('count');
  const startBtn = document.getElementById('startBtn');
  const nextBtn = document.getElementById('nextBtn');
  const showAnswerBtn = document.getElementById('showAnswerBtn');
  const submitBtn = document.getElementById('submitBtn');
  const answerInput = document.getElementById('answer');
  const problemEl = document.getElementById('problem');
  const feedbackEl = document.getElementById('feedback');
  const indexDisplay = document.getElementById('indexDisplay');
  const correctEl = document.getElementById('correct');
  const wrongEl = document.getElementById('wrong');
  const remainingEl = document.getElementById('remaining');
  const progBar = document.getElementById('prog');
  const timerEl = document.getElementById('timer');
  const resetBtn = document.getElementById('resetBtn');
  const replayBtn = document.getElementById('replayBtn');
  const modeTypeEl = document.getElementById('modeType');

  let questions = [];
  let current = -1;
  let total = 0;
  let correct = 0;
  let wrong = 0;
  let timer = null;
  let seconds = 0;
  let started = false;

  function formatTime(s){
    const mm = Math.floor(s/60).toString().padStart(2,'0');
    const ss = (s%60).toString().padStart(2,'0');
    return mm+':'+ss;
  }

  function startTimer(){
    clearInterval(timer);
    seconds = 0;
    timerEl.textContent = '00:00';
    timer = setInterval(()=>{
      seconds++;
      timerEl.textContent = formatTime(seconds);
    },1000);
  }

  function stopTimer(){
    clearInterval(timer);
    timer = null;
  }

  function genOne(mode){
    // returns {a, b, op, answer, text}
    // ensure 0 <= operands <=100 and result within 0..100
    if(mode === 'add'){
      // pick a in 0..100, b in 0..(100-a)
      const a = Math.floor(Math.random() * 101);
      const b = Math.floor(Math.random() * (101 - a));
      return {a, b, op: '+', answer: a + b, text: `${a} + ${b} =`};
    } else if(mode === 'sub'){
      // pick a in 0..100, b in 0..a
      const a = Math.floor(Math.random() * 101);
      const b = Math.floor(Math.random() * (a + 1));
      return {a, b, op: '-', answer: a - b, text: `${a} - ${b} =`};
    } else { // mix
      if(Math.random() < 0.5) return genOne('add');
      return genOne('sub');
    }
  }

  function generateQuestions(){
    const m = modeEl.value;
    const cnt = parseInt(countEl.value,10) || 10;
    const arr = [];
    for(let i=0;i<cnt;i++){
      arr.push(genOne(m));
    }
    return arr;
  }

  function renderProgress(){
    const idx = Math.max(0, current);
    indexDisplay.textContent = `${Math.min(idx+1,total)}/${total}`;
    remainingEl.textContent = String(total - Math.max(0, idx+1));
    const pct = total ? Math.round((idx+1)/total*100) : 0;
    progBar.style.width = pct + '%';
    correctEl.textContent = String(correct);
    wrongEl.textContent = String(wrong);
  }

  function setProblem(i){
    if(i < 0 || i >= total) {
      problemEl.textContent = '--';
      answerInput.disabled = true;
      submitBtn.disabled = true;
      nextBtn.disabled = true;
      showAnswerBtn.disabled = true;
      return;
    }
    const q = questions[i];
    problemEl.textContent = q.text;
    answerInput.value = '';
    answerInput.disabled = false;
    submitBtn.disabled = false;
    nextBtn.disabled = true; // enable after submit or show answer
    showAnswerBtn.disabled = false;
    feedbackEl.textContent = '';
    feedbackEl.className = 'feedback';
    answerInput.focus();
    renderProgress();
  }

  function start(){
    questions = generateQuestions();
    total = questions.length;
    current = 0;
    correct = 0;
    wrong = 0;
    started = true;
    startTimer();
    setProblem(current);
    updateButtonsOnStart();
    renderProgress();
  }

  function updateButtonsOnStart(){
    startBtn.disabled = true;
    resetBtn.disabled = false;
    submitBtn.disabled = false;
    nextBtn.disabled = true;
    showAnswerBtn.disabled = false;
  }

  function end(){
    started = false;
    stopTimer();
    startBtn.disabled = false;
    submitBtn.disabled = true;
    nextBtn.disabled = true;
    showAnswerBtn.disabled = true;
    answerInput.disabled = true;
    feedbackEl.innerHTML = `完成：正确 ${correct}，错误 ${wrong}，用时 ${formatTime(seconds)}`;
    feedbackEl.className = '';
    renderProgress();
  }

  function submitAnswer(){
    if(!started || current < 0 || current >= total) return;
    const q = questions[current];
    const raw = answerInput.value.trim();
    if(raw === '') {
      feedbackEl.textContent = '请输入答案或按 显示答案。';
      feedbackEl.className = 'feedback answer-wrong';
      return;
    }
    const user = Number(raw);
    if(Number.isNaN(user)){
      feedbackEl.textContent = '请输入数字答案。';
      feedbackEl.className = 'feedback answer-wrong';
      return;
    }
    const isCorrect = user === q.answer;
    // Mode behavior
    if(modeTypeEl.value === 'practice'){
      if(isCorrect){
        feedbackEl.textContent = '回答正确 ✓';
        feedbackEl.className = 'feedback answer-correct';
        correct++;
      } else {
        feedbackEl.textContent = `错误 ✕，正确答案： ${q.answer}`;
        feedbackEl.className = 'feedback answer-wrong';
        wrong++;
      }
      submitBtn.disabled = true;
      nextBtn.disabled = false;
    } else { // test mode: don't show correct/incorrect, just record
      if(isCorrect) correct++; else wrong++;
      feedbackEl.textContent = '已记录，点击 下一题。';
      feedbackEl.className = 'feedback';
      submitBtn.disabled = true;
      nextBtn.disabled = false;
      // Do not reveal correctness or correct answer until end
    }
    renderProgress();
  }

  function showAnswer(){
    if(!started || current < 0 || current >= total) return;
    const q = questions[current];
    feedbackEl.textContent = `答案：${q.answer}`;
    feedbackEl.className = 'feedback';
    submitBtn.disabled = true;
    nextBtn.disabled = false;
  }

  function next(){
    if(!started) return;
    if(current < total - 1){
      current++;
      setProblem(current);
      // keep next disabled until submit
    } else {
      // finished
      end();
    }
  }

  // Event listeners
  startBtn.addEventListener('click', ()=> start());
  submitBtn.addEventListener('click', ()=> submitAnswer());
  nextBtn.addEventListener('click', ()=> next());
  showAnswerBtn.addEventListener('click', ()=> showAnswer());

  resetBtn.addEventListener('click', ()=>{
    stopTimer();
    questions = [];
    current = -1;
    total = 0;
    correct = 0;
    wrong = 0;
    started = false;
    problemEl.textContent = '--';
    answerInput.value = '';
    answerInput.disabled = true;
    submitBtn.disabled = true;
    nextBtn.disabled = true;
    showAnswerBtn.disabled = true;
    startBtn.disabled = false;
    feedbackEl.textContent = '';
    progBar.style.width = '0%';
    indexDisplay.textContent = '0/0';
    remainingEl.textContent = '0';
    correctEl.textContent = '0';
    wrongEl.textContent = '0';
    timerEl.textContent = '00:00';
  });

  replayBtn.addEventListener('click', ()=>{
    // restart with same settings
    stopTimer();
    questions = [];
    current = -1;
    total = 0;
    correct = 0;
    wrong = 0;
    start();
  });

  // Keyboard handling
  answerInput.addEventListener('keydown', (e)=>{
    if(e.key === 'Enter'){
      submitAnswer();
    } else if(e.key === 'Escape'){
      answerInput.value = '';
    }
  });

  // initialize UI
  (function init(){
    resetBtn.disabled = false;
    startBtn.disabled = false;
    submitBtn.disabled = true;
    nextBtn.disabled = true;
    showAnswerBtn.disabled = true;
    answerInput.disabled = true;
    indexDisplay.textContent = '0/0';
    remainingEl.textContent = '0';
    correctEl.textContent = '0';
    wrongEl.textContent = '0';
  })();

})();
</script>
</body>
</html>
